name: Int√©gration continue

permissions:
  contents: read

on:
  workflow_dispatch:
  pull_request:
    paths-ignore: ["**.md"]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  pnpm-install:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fetch deps
        if: ${{ !env.ACT }}
        uses: ./.github/actions/pnpm-install
        with:
          bryntum_access_token: ${{ secrets.BRYNTUM_ACCESS_TOKEN }}

  test-syntax:
    needs: [pnpm-install]
    uses: ./.github/workflows/test-syntax.yml

  test-build:
    needs: [test-syntax]
    uses: ./.github/workflows/test-build.yml
    secrets: inherit

  init-db:
    needs: [test-syntax]
    uses: ./.github/workflows/init-db.yml
    secrets: inherit

  test-api:
    needs: [init-db]
    uses: ./.github/workflows/test-api.yml
    secrets: inherit

  test-package-api:
    needs: [init-db]
    uses: ./.github/workflows/test-package-api.yml
    secrets: inherit

  test-backend:
    needs: [init-db]
    uses: ./.github/workflows/test-backend.yml
    secrets: inherit

  test-db-deploy:
    needs: [init-db]
    uses: ./.github/workflows/test-db-deploy.yml
    secrets: inherit

  test-package-ui:
    needs: [test-syntax]
    uses: ./.github/workflows/test-package-ui.yml

  test-app:
    needs: [test-syntax]
    uses: ./.github/workflows/test-app.yml

  test-e2e:
    needs: [init-db]
    uses: ./.github/workflows/test-e2e.yml
    secrets: inherit
